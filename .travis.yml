language: minimal
sudo: required

services:
  - docker

env:
  - GH_USER=mtneug GH_REPO=freetz FREETZ_TEST_CONFIG=type-7490

addons:
    packages:
      - shellcheck

before_install:
  - docker info
  - shellcheck --version

install: true

script:
  - make IMAGE=$GH_USER/$GH_REPO
  - mkdir images
  - docker run --rm -it -v $PWD/testdata/$FREETZ_TEST_CONFIG:/.config -v $PWD/images:/freetz/images $GH_USER/$GH_REPO build trunk --no-menuconfig
  - test `ls $PWD/images/*.image -l | wc -l` -eq 1

