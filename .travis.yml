language: minimal
sudo: required

services:
  - docker

env:
  - FREETZ_TEST_CONFIG=type-7490

addons:
    packages:
      - shellcheck

before_install:
  - docker info
  - shellcheck --version

install: true

script:
  - make IMAGE=$TRAVIS_REPO_SLUG
  - mkdir $PWD/images ; chmod 777 $PWD/images
  - docker run --rm -it -v $PWD/testdata/$FREETZ_TEST_CONFIG:/.config -v $PWD/images:/freetz/images $TRAVIS_REPO_SLUG build trunk --no-menuconfig
  - test `ls $PWD/images/*.image -l | wc -l` -eq 1

